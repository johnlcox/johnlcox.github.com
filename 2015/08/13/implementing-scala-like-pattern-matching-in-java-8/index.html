<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Implementing Scala-like Pattern Matching in Java 8 | John Leacox</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="I’ve been writing Scala off and on for the last several years. I took both of the Scala courses on Coursera and really enjoyed them. However, I still write a lot of Java. There are a lot of Scala feat">
<meta property="og:type" content="article">
<meta property="og:title" content="Implementing Scala-like Pattern Matching in Java 8">
<meta property="og:url" content="http://johnlcox.github.com/2015/08/13/implementing-scala-like-pattern-matching-in-java-8/index.html">
<meta property="og:site_name" content="John Leacox">
<meta property="og:description" content="I’ve been writing Scala off and on for the last several years. I took both of the Scala courses on Coursera and really enjoyed them. However, I still write a lot of Java. There are a lot of Scala feat">
<meta property="og:updated_time" content="2016-07-10T22:40:18.806Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Implementing Scala-like Pattern Matching in Java 8">
<meta name="twitter:description" content="I’ve been writing Scala off and on for the last several years. I took both of the Scala courses on Coursera and really enjoyed them. However, I still write a lot of Java. There are a lot of Scala feat">
<meta name="twitter:creator" content="@johnlcox">
  
    <link rel="alternate" href="/atom.xml" title="John Leacox" type="application/atom+xml">
  
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" integrity="sha384-XdYbMnZ/QjLh6iI4ogqCTaIjrFk87ip+ekIjefZch0Y+PvJ8CDYtEs1ipDmPorQ+" crossorigin="anonymous">

  <link rel="stylesheet" href="/css/styles.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-36983897-3', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>

<body>
  <nav class="navbar navbar-inverse">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-menu-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="main-menu-navbar">
      <ul class="nav navbar-nav">
        
          <li><a class=""
                 href="/index.html">Home</a></li>
        
          <li><a class=""
                 href="/archives/">Archives</a></li>
        
      </ul>

      <!--
      <ul class="nav navbar-nav navbar-right">
        
          <li><a href="/atom.xml" title="RSS Feed"><i class="fa fa-rss"></i></a></li>
        
      </ul>
      -->
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>

  <div class="container">
    <div class="blog-header">
  <h1 class="blog-title">John Leacox</h1>
  
</div>

    <div class="row">
        <div class="col-sm-8 blog-main">
          <article id="post-2015-08-13-implementing-scala-like-pattern-matching-in-java-8" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 class="article-title" itemprop="name">
      Implementing Scala-like Pattern Matching in Java 8
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2015/08/13/implementing-scala-like-pattern-matching-in-java-8/" class="article-date"><time datetime="2015-08-14T04:16:00.000Z" itemprop="datePublished">2015-08-13</time></a>
</div>

    
    

  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <p>I’ve been writing Scala off and on for the last several years. I took both of the Scala courses on Coursera and really enjoyed them. However, I still write a lot of Java. There are a lot of Scala features that I miss while working with Java, and as Java 8 was coming out in early 2014, I thought about feature parity between the two languages. The addition of lambdas to Java is great, but one of my favorite features of Scala is pattern matching, and Java 8 does not include that. At the time I started to wonder if pattern matching could be implemented as a Java library. I wasn’t sure if it would even be possible, but I wrote up a quick <a href="https://gist.github.com/johnlcox/d6dded9807c5f6580626" target="_blank" rel="external">Github gist</a> with what some different patterns might look like.</p>
<p>My gist from early 2014 includes Guava <code>Optional</code> matching (I hadn’t yet noticed that Java 8 included it’s own <code>Optional</code> type), Integer matching as an example of matching on exact values, Cons like matching on a list, and the concept of an <code>orElse</code> case. I wrote these examples directly in the gist editor, I’m quite sure they don’t compile, but I wanted to get the concept out of my head and stored somewhere. Once I got the idea out of my head, I promptly forgot about it for just over a year.</p>
<p>In May 2015 I was starting to use Java 8 on some real projects, and one day that old gist popped into my head. I started thinking about it more and decided it might be worth giving a more in-depth look. Initially, I did some searches to see if any libraries had already been created for this. I found a couple that had some pattern matching features, but they were not exactly what I had imagined. <a href="https://github.com/javaslang" target="_blank" rel="external">Javaslang</a>, provides a lot of nice functional features that are missing from Java 8, but pattern matching isn’t the focus of this library, and it only has support for matching on type and value. Benji Weber gives examples of pattern matching on his <a href="http://benjiweber.co.uk/blog/2014/08/26/deep-pattern-matching-in-java/" target="_blank" rel="external">blog</a> and implemented them in his <a href="https://github.com/benjiman/expressions" target="_blank" rel="external">expressions library</a>.</p>
<p>The expressions library pattern matching was closer to what I had in mind. It can extract top-level and nested values, but it requires implementing a ‘constructor’ method for anything you want to match on and doesn’t built-in matching for things like <code>Optional</code> or <code>List</code>. At this point I decided I’d give a shot at implementing pattern matching in Java 8 that is as close to the Scala pattern matching as possible. I like to try to come up with a good name for my projects, so I spent some time with a thesaurus looking for words related to ‘matching’ and ‘patterns’, and I eventually landed on <a href="http://dictionary.reference.com/browse/motif" target="_blank" rel="external">motif</a>.</p>
<p>Before I go into some details about the process of implementing motif, below are some examples of what code using motif might look like.</p>
<p>Matching on Optional:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">Optional&lt;Person&gt; personOpt = getPerson();</div><div class="line">match(personOpt)</div><div class="line">    .when(some(any())).then(person -&gt; doStuff(person))</div><div class="line">    .when(none()).then(() -&gt; System.out.println(<span class="string">"Person not found"</span>))</div><div class="line">    .doMatch();</div></pre></td></tr></table></figure>
<p>Nested matching:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">Optional&lt;Tuple2&lt;String, String&gt;&gt; opt = Optional.of(Tuple2.of(<span class="string">"first"</span>, <span class="string">"second"</span>));</div><div class="line">match(opt)</div><div class="line">    .when(some(tuple2(eq(<span class="string">"third"</span>), any()))).then(b -&gt; doStuff(b))</div><div class="line">    .when(some(tuple2(any(), eq(<span class="string">"second"</span>)))).then(a -&gt; doStuff(a))</div><div class="line">    .when(none()).then(() -&gt; System.out.println(<span class="string">"Tuple not found"</span>))</div><div class="line">    .doMatch();</div></pre></td></tr></table></figure>
<p>Checkout the <a href="http://john.leacox.com/motif/" target="_blank" rel="external">Github page</a> or <a href="https://github.com/johnlcox/motif" target="_blank" rel="external">Github repo</a> for additional details. Version 0.1 of motif is available from maven central. It is a little more verbose (horizontally) than Scala, but it provides much of the same functionality. Currently, it supports extracting a maximum of 3 parameters, whereas Scala supports up to 22 in 2.10 and possibly unlimited in 2.11+? I’ve rarely found myself needing to extract more than 3 parameters in Scala, so I thought this would be an OK limitation for now. Support for additional parameters could be added in the future, but it will require writing additional code generation logic.</p>
<p>Motif provides many useful pattern matchers out of the box, but it is also very extensible. A Guava extension could be created, for instance, that provides matchers for Guava’s <code>Optional</code> and any other Guava concepts that would be useful to match on. The motif-generator project provides builders for generating matcher cases for extensions. <a href="https://github.com/johnlcox/motif/blob/master/generator/src/main/java/com/leacox/motif/cases/OptionalCasesGenerator.java" target="_blank" rel="external">OptionalCasesGenerator</a> is a good example for using the generator.</p>
<p>The implementation of the Motif pattern matching happened in three phases. The initial phase was a varargs method that accepted the matching cases, and automatically executed the matching. This ran into ambiguity issues for consumers of the code, so I ended up scrapping it and converting to a fluent interface. By using a fluent interface, I could use intermediate classes to track types and avoid ambiguity. This second phase led to what is essentially the final API, except without nested extraction. Once I saw that the fluent interface was working well, I added nested extraction as a third phase. The nested extraction leads to a bit of combinatorial explosion of the API, so I added code generation during this phase to reduce the likelyhood of errors and to avoid writing very similar code multiple times. The code generation portion, is a separate library, and makes it easy for third party extensions to generate all of the necessary methods needed.</p>
<p>Motif has been released as version 0.1 and is available in Maven central. The API is pretty solid, and I don’t expect any dramatic changes in the future. Give it a try in your Java 8 code. </p>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="http://johnlcox.github.com/2015/08/13/implementing-scala-like-pattern-matching-in-java-8/" data-id="ciqhax8ef000481jxlkj28toi" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
        <a href="http://johnlcox.github.com/2015/08/13/implementing-scala-like-pattern-matching-in-java-8/#disqus_thread" class="article-comment-link">
          <i class="fa fa-comment"></i> Comments
        </a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/lambda-expressions/">lambda expressions</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pattern-matching/">pattern matching</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/scala/">scala</a></li></ul>


    </footer>
  </div>
  
    
<ul id="article-nav" class="nav nav-pills nav-justified">
  
  <li role="presentation">
    <a href="/2013/02/11/a-safer-way-to-create-java-subprocesses/" id="article-nav-older" class="article-nav-link-wrap">
      <i class="fa fa-chevron-left pull-left"></i>
      <span class="article-nav-link-title">A Safer Way To Create Java Subprocesses</span>
    </a>
  </li>
  
  
  <li role="presentation">
    <a href="/2015/10/26/staying-motivated-on-side-projects/" id="article-nav-newer" class="article-nav-link-wrap">
      <span class="article-nav-link-title">Staying Motivated on Side Projects</span>
      <i class="fa fa-chevron-right pull-right"></i>
    </a>
  </li>
  
</ul>


  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>



        </div>
        <div class="col-sm-3 col-sm-offset-1 blog-sidebar">
          
  
  <div class="sidebar-module">
    <h4>Recents</h4>
    <ul class="sidebar-module-list">
      
        <li>
          <a href="/2015/10/26/staying-motivated-on-side-projects/">Staying Motivated on Side Projects</a>
        </li>
      
        <li>
          <a href="/2015/08/13/implementing-scala-like-pattern-matching-in-java-8/">Implementing Scala-like Pattern Matching in Java 8</a>
        </li>
      
        <li>
          <a href="/2013/02/11/a-safer-way-to-create-java-subprocesses/">A Safer Way To Create Java Subprocesses</a>
        </li>
      
        <li>
          <a href="/2013/01/17/differentiate-java-processes-by-working-directory/">Differentiate Java Processes by Working Directory</a>
        </li>
      
        <li>
          <a href="/2013/01/07/drumming-as-exercise-routine/">Drumming as Exercise Routine</a>
        </li>
      
    </ul>
  </div>


  
  <div class="sidebar-module">
    <h4>Tags</h4>
    <ul class="sidebar-module-list"><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/blogging/">blogging</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/drums/">drums</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/exercise/">exercise</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/geolode/">geolode</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/java/">java</a><span class="sidebar-module-list-count">4</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/lambda-expressions/">lambda expressions</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/linux/">linux</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/lodeup/">lodeup</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/motivation/">motivation</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/music/">music</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/pattern-matching/">pattern matching</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/running/">running</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/scala/">scala</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/shell/">shell</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/stackify/">stackify</a><span class="sidebar-module-list-count">2</span></li></ul>
  </div>



  
  <div class="sidebar-module">
    <h4>Tag Cloud</h4>
    <p class="tagcloud">
      <a href="/tags/blogging/" style="font-size: 10px;">blogging</a> <a href="/tags/drums/" style="font-size: 10px;">drums</a> <a href="/tags/exercise/" style="font-size: 10px;">exercise</a> <a href="/tags/geolode/" style="font-size: 10px;">geolode</a> <a href="/tags/java/" style="font-size: 20px;">java</a> <a href="/tags/lambda-expressions/" style="font-size: 10px;">lambda expressions</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/lodeup/" style="font-size: 10px;">lodeup</a> <a href="/tags/motivation/" style="font-size: 10px;">motivation</a> <a href="/tags/music/" style="font-size: 10px;">music</a> <a href="/tags/pattern-matching/" style="font-size: 10px;">pattern matching</a> <a href="/tags/running/" style="font-size: 10px;">running</a> <a href="/tags/scala/" style="font-size: 10px;">scala</a> <a href="/tags/shell/" style="font-size: 15px;">shell</a> <a href="/tags/stackify/" style="font-size: 15px;">stackify</a>
    </p>
  </div>


  
  <div class="sidebar-module">
    <h4>Archives</h4>
    <ul class="sidebar-module-list"><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2015/10/">October 2015</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2015/08/">August 2015</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2013/02/">February 2013</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2013/01/">January 2013</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2012/12/">December 2012</a><span class="sidebar-module-list-count">3</span></li></ul>
  </div>




        </div>
    </div>
  </div>
  <footer class="blog-footer">
  <div class="container">
    <div id="footer-info" class="inner">
      &copy; 2016 John Leacox<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

  
<script>
  var disqus_shortname = 'johnlcox';
  
  var disqus_url = 'http://johnlcox.github.com/2015/08/13/implementing-scala-like-pattern-matching-in-java-8/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>



<script src="/js/script.js"></script>

</body>
</html>
