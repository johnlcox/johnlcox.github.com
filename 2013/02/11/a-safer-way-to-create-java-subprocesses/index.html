<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>A Safer Way To Create Java Subprocesses | John Leacox</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="If you have ever had to start a subprocess from a Java application, then you likely know how painful it can be to use the Process class via Runtime.exec or ProcessBuilder. There are numerous posts on">
<meta property="og:type" content="article">
<meta property="og:title" content="A Safer Way To Create Java Subprocesses">
<meta property="og:url" content="http://john.leacox.com/2013/02/11/a-safer-way-to-create-java-subprocesses/index.html">
<meta property="og:site_name" content="John Leacox">
<meta property="og:description" content="If you have ever had to start a subprocess from a Java application, then you likely know how painful it can be to use the Process class via Runtime.exec or ProcessBuilder. There are numerous posts on">
<meta property="og:updated_time" content="2016-07-10T22:40:18.806Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="A Safer Way To Create Java Subprocesses">
<meta name="twitter:description" content="If you have ever had to start a subprocess from a Java application, then you likely know how painful it can be to use the Process class via Runtime.exec or ProcessBuilder. There are numerous posts on">
<meta name="twitter:creator" content="@johnlcox">
  
    <link rel="alternative" href="/atom.xml" title="John Leacox" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
    <link href="http://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700|Ubuntu:400,700,400italic" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-36983897-3']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">John Leacox</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        <a id="nav-github-link" class="nav-icon" href="https://github.com/johnlcox" target="_blank"></a>
        <a id="nav-linkedin-link" class="nav-icon" href="https://www.linkedin.com/in/johnlcox" target="_blank"></a>
        <a id="nav-twitter-link" class="nav-icon" href="https://twitter.com/johnlcox" target="_blank"></a>
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://john.leacox.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-a-safer-way-to-create-java-subprocesses" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2013/02/11/a-safer-way-to-create-java-subprocesses/" class="article-date">
  <time datetime="2013-02-12T04:37:00.000Z" itemprop="datePublished">2013-02-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      A Safer Way To Create Java Subprocesses
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>If you have ever had to start a subprocess from a Java application, then you likely know how painful it can be to use the Process class via Runtime.exec or ProcessBuilder. There are numerous posts on <a href="http://stackoverflow.com/search?tab=votes&amp;q=%5bjava%5d%20processbuilder" target="_blank" rel="external">stackoverflow</a> as well as a multitude of blog posts on the correct usage of the Process class. I found a blog post on the <a href="http://kylecartmell.com/?p=9" target="_blank" rel="external">five common pitfalls of the Process class</a> to be the most helpful when I began using subprocesses. Being aware of the pitfalls helps, but if you are running a lot of subprocesses, the additional code needed in each instance can become tedious and you increase the odds of making a mistake. I ended up creating the <a href="https://github.com/johnlcox/process-warden" target="_blank" rel="external">process-warden</a> library for a safer way to create Java subprocesses that is reusable.</p>
<p>I make use of subprocesses in the <a href="http://www.stackify.com/" target="_blank" rel="external">Stackify</a> monitoring agent for executing shell commands as well as for updating a running agent – which I hope to write a separate blog post on at some point. It quickly became clear that having a common way of providing a timeout for the Process.waitFor method and making sure that the streams are closed would be very beneficial. I created the <a href="https://github.com/johnlcox/process-warden/blob/master/src/main/java/com/leacox/process/FinalizedProcess.java" target="_blank" rel="external">FinalizedProcess</a> and <a href="https://github.com/johnlcox/process-warden/blob/master/src/main/java/com/leacox/process/FinalizedProcessBuilder.java" target="_blank" rel="external">FinalizedProcessBuilder</a> classes that wrap the usage of the Process class and take care of many of the common pitfalls.</p>
<p>FinalizedProcess implements Closable and in its close method it makes sure that all of the subprocess streams are closed as well as optionally destroying the subprocess. It also has a waitFor method that takes a timeout in milliseconds instead of a no parameter waitFor. If the subprocess execution takes longer than the timeout, then an InterruptedException will be thrown and the interrupted flag will be cleared when InterruptedExceptions are thrown. With these additions three of the five common pitfalls are remedied.</p>
<p>For the two remaining pitfalls the problem of process grandchildren not being kill when a subprocess is killed cannot be remedied via code, so that will still require user knowledge to avoid. As for the prompt consumption of subprocess output, I didn’t have an immediate need for discarding the output, so the initial version of process-warden doesn’t provide any functionality for consuming the output. In a future release I hope to add a class that will silently consume the output and error streams along with a method on FinalizedProcessBuilder to enable the silent consumption.</p>
<p>So how do you use process-warden? It’s easy. </p>
<p>Add it to your maven project:<br><figure class="highlight xml"><table><tr><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.leacox.process<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>process−warden<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>Use FinalizedProcessBuilder to create a FinalizedProcess to execute:<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">// With Java 7</span></div><div class="line">FinalizedProcessBuilder pb = <span class="keyword">new</span> FinalizedProcessBuilder(<span class="string">"myCommand"</span>, <span class="string">"myArg"</span>);</div><div class="line"><span class="keyword">try</span> (FinalizedProcess process = pb.start()) &#123;</div><div class="line">  <span class="keyword">int</span> returnVal = process.waitFor(<span class="number">5000</span>); <span class="comment">// 5 second timeout</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// With Java 6</span></div><div class="line">FinalizedProcessBuilder pb = <span class="keyword">new</span> FinalizedProcessBuilder(<span class="string">"myCommand"</span>, <span class="string">"myArg"</span>);</div><div class="line">FinalizedProcess process = pb.start();</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">  <span class="keyword">int</span> returnVal = process.waitFor(<span class="number">5000</span>); <span class="comment">// 5 second timeout</span></div><div class="line">&#125; <span class="keyword">finally</span> &#123;</div><div class="line">  process.close();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>If you are currently using Process and ProcessBuilder, give process-warden a shot. It should help simplify your code. I appreciate any feedback or suggestions. Feel free to log issues or fork the <a href="https://github.com/johnlcox/process-warden" target="_blank" rel="external">project</a> on github.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://john.leacox.com/2013/02/11/a-safer-way-to-create-java-subprocesses/" data-id="ciqkuwsm2000aptjxntkyi3gr" class="article-share-link">Share</a>
      
        <a href="http://john.leacox.com/2013/02/11/a-safer-way-to-create-java-subprocesses/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2015/08/13/implementing-scala-like-pattern-matching-in-java-8/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Implementing Scala-like Pattern Matching in Java 8
        
      </div>
    </a>
  
  
    <a href="/2013/01/17/differentiate-java-processes-by-working-directory/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Differentiate Java Processes by Working Directory</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2015/10/26/staying-motivated-on-side-projects/">Staying Motivated on Side Projects</a>
          </li>
        
          <li>
            <a href="/2015/08/13/implementing-scala-like-pattern-matching-in-java-8/">Implementing Scala-like Pattern Matching in Java 8</a>
          </li>
        
          <li>
            <a href="/2013/02/11/a-safer-way-to-create-java-subprocesses/">A Safer Way To Create Java Subprocesses</a>
          </li>
        
          <li>
            <a href="/2013/01/17/differentiate-java-processes-by-working-directory/">Differentiate Java Processes by Working Directory</a>
          </li>
        
          <li>
            <a href="/2013/01/07/drumming-as-exercise-routine/">Drumming as Exercise Routine</a>
          </li>
        
          <li>
            <a href="/2012/12/28/writing-a-good-linux-init-script/">Writing a Good Linux Init Script</a>
          </li>
        
          <li>
            <a href="/2012/12/27/my-favorite-music-of-2012/">My Favorite Music of 2012</a>
          </li>
        
          <li>
            <a href="/2012/12/14/blogging-is-hard/">Blogging is Hard</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/blogging/">blogging</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/drums/">drums</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/exercise/">exercise</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/geolode/">geolode</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lambda-expressions/">lambda expressions</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lodeup/">lodeup</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/motivation/">motivation</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/music/">music</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pattern-matching/">pattern matching</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/running/">running</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scala/">scala</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/">shell</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/stackify/">stackify</a><span class="tag-list-count">2</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/blogging/" style="font-size: 10px;">blogging</a> <a href="/tags/drums/" style="font-size: 10px;">drums</a> <a href="/tags/exercise/" style="font-size: 10px;">exercise</a> <a href="/tags/geolode/" style="font-size: 10px;">geolode</a> <a href="/tags/java/" style="font-size: 20px;">java</a> <a href="/tags/lambda-expressions/" style="font-size: 10px;">lambda expressions</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/lodeup/" style="font-size: 10px;">lodeup</a> <a href="/tags/motivation/" style="font-size: 10px;">motivation</a> <a href="/tags/music/" style="font-size: 10px;">music</a> <a href="/tags/pattern-matching/" style="font-size: 10px;">pattern matching</a> <a href="/tags/running/" style="font-size: 10px;">running</a> <a href="/tags/scala/" style="font-size: 10px;">scala</a> <a href="/tags/shell/" style="font-size: 15px;">shell</a> <a href="/tags/stackify/" style="font-size: 15px;">stackify</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/02/">February 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/01/">January 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/12/">December 2012</a><span class="archive-list-count">3</span></li></ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 John Leacox<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'johnlcox';
  
  var disqus_url = 'http://john.leacox.com/2013/02/11/a-safer-way-to-create-java-subprocesses/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

<div id="scroll2top" style="position:fixed;bottom:150px;right:50px;cursor: pointer;Z-index:9999">
<a title="返回顶部" href="#"><img src="/scroll2top/scrollup.png"/></a>
</div>
<script src="/scroll2top/scroll2top.js"></script>



  </div>
</body>
</html>