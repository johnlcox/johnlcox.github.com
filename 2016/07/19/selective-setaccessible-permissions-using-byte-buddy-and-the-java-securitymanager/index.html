<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Selective setAccessible permissions using Byte Buddy and the Java SecurityManager | John Leacox</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="The Java SecurityManager provides a lot of good permissions for restricted what untrusted code can access. The downside of the standard permissions is that many of them are too broad, making it hard t">
<meta property="og:type" content="article">
<meta property="og:title" content="Selective setAccessible permissions using Byte Buddy and the Java SecurityManager">
<meta property="og:url" content="http://john.leacox.com/2016/07/19/selective-setaccessible-permissions-using-byte-buddy-and-the-java-securitymanager/index.html">
<meta property="og:site_name" content="John Leacox">
<meta property="og:description" content="The Java SecurityManager provides a lot of good permissions for restricted what untrusted code can access. The downside of the standard permissions is that many of them are too broad, making it hard t">
<meta property="og:updated_time" content="2016-07-20T02:26:14.613Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Selective setAccessible permissions using Byte Buddy and the Java SecurityManager">
<meta name="twitter:description" content="The Java SecurityManager provides a lot of good permissions for restricted what untrusted code can access. The downside of the standard permissions is that many of them are too broad, making it hard t">
<meta name="twitter:creator" content="@johnlcox">
  
    <link rel="alternative" href="/atom.xml" title="John Leacox" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
    <link href="http://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700|Ubuntu:400,700,400italic" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-36983897-3']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">John Leacox</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        <a id="nav-github-link" class="nav-icon" href="https://github.com/johnlcox" target="_blank"></a>
        <a id="nav-linkedin-link" class="nav-icon" href="https://www.linkedin.com/in/johnlcox" target="_blank"></a>
        <a id="nav-twitter-link" class="nav-icon" href="https://twitter.com/johnlcox" target="_blank"></a>
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://john.leacox.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-selective-setaccessible-permissions-using-byte-buddy-and-the-java-securitymanager" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/07/19/selective-setaccessible-permissions-using-byte-buddy-and-the-java-securitymanager/" class="article-date">
  <time datetime="2016-07-20T02:25:08.000Z" itemprop="datePublished">2016-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Selective setAccessible permissions using Byte Buddy and the Java SecurityManager
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>The Java <code>SecurityManager</code> provides a lot of good permissions for restricted what untrusted code can access. The downside of the standard permissions is that many of them are too broad, making it hard to enable permissions around commonly used functionality without defeating the purpose of the restricted security. The permissions around reflections are one of these cases, where the permissions around the <code>setAccessible</code> reflections method is either all on or all off. It is possible to work around this default behavior, providing more selective fine-grained permissions, by using bytecode weaving. However, for any of this this to work the Java <code>SecurityManager</code> must be used along with loading the code that these permissions will be applied to from a separate jar, probably using a custom or at least isolated instance of a <code>URLClassLoader</code>. This is a prerequisite which has already been well documented by Will Sargent in his post <a href="https://tersesystems.com/2015/12/29/sandbox-experiment/" target="_blank" rel="external">Self-Protecting Sandbox Using SecurityManager</a> as well as my own example sandbox runtime environment <a href="https://github.com/johnlcox/sandbox-runtime" target="_blank" rel="external">sandbox-runtime</a>.</p>
<p>The main permission in question around the <code>setAccessible</code> method is <code>ReflectPermission(&quot;suppressAccessChecks&quot;)</code>. When this permission is disabled it disallows changing the accessibility of fields, methods, and constructors. By default the <code>SecurityManager</code> is not enabled, which means all permission checks are disabled. Since this is the standard way Java is run, many common libraries, and even many alternative JVM language are dependent on being able to use reflection to access private fields and methods. If you do need to run code with a <code>SecurityManager</code>, then the <code>ReflectPermission(&quot;suppressAccessChecks&quot;)</code> permission defeats all security provided by the <code>SecurityManager</code>. Untrusted code can make use of <code>setAccessible</code> to work around and disable the <code>SecurityManager</code> entirely.</p>
<p>It may appear that the only two choices are between having a secure environment and disallowing untrusted code from using libraries or languages that require reflection, or allowing such access by having an unsecure environment. However, there is an alternative if you are willing to put in the work. Libraries like <a href="https://github.com/raphw/byte-buddy" target="_blank" rel="external">Byte Buddy</a> make it possible to replace methods of existing classes with new implementations, at runtime, through the use of a Java agent.</p>
<p>I have implemented a custom, more fine-grained, permission around access to the <code>setAccessible</code> method. In my examples I have chosen to use the code source or the <code>ClassLoader</code> as the determining factor; code that attempts to call <code>setAccessible</code> will only be granted permission if both itself and the class it is attempting to change the accessibility of are from the same class loader. In other words, this reflections method can only be used on classes from the same jar as the untrusted code; it cannot be used to access private fields of standard Java classes. This is just what I chose, as it fit best for the security settings I’m targeting. The determining factor could be setup in many different ways, including a package or class whitelist or blacklist.</p>
<p>The first piece that is needed is the new custom <code>Permission</code>. This permission uses the class loader of the caller and callee to determine whether permissions should be granted or not.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserSetAccessiblePermission</span> <span class="keyword">extends</span> <span class="title">Permission</span> </span>&#123;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">final</span> ClassLoader loader;  </div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">UserSetAccessiblePermission</span><span class="params">(ClassLoader loader)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>(<span class="string">"userSetAccessible"</span>);</div><div class="line"></div><div class="line">    <span class="keyword">this</span>.loader = loader;</div><div class="line">  &#125;  </div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">implies</span><span class="params">(Permission permission)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (!(permission <span class="keyword">instanceof</span> UserSetAccessiblePermission)) &#123;</div><div class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    UserSetAccessiblePermission that = (UserSetAccessiblePermission) permission;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> that.loader == <span class="keyword">this</span>.loader;</div><div class="line">  &#125;  </div><div class="line"></div><div class="line">  <span class="comment">// equals and hashCode omitted  </span></div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getActions</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">""</span>;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>With the permission class in place, next we need a place to actually check the permission. This will happen in our custom implementation of the <code>setAccessible</code> method that will replace the standard <code>setAccessible</code> method. This can be done using Byte Buddy by creating our custom implementation as a static method with method parameters compatible with the standard <code>setAccessible</code>.</p>
<p>This class has a few interesting parts. It uses the <code>@This</code> annotation from Byte Buddy to get the object the original <code>setAccessible</code> method was called on. Access to this object can be used to retrieve the class loader of the object the accessibility is attempting to be changed on (callee). If the class loader is not an instance of the user class loader, then we just check the standard permission, but if it is a user class loader, then we continue with checking the custom permission. To check the permission we create an instance of the new permission with the class loader of the callee. If the caller has the same permission with the same instance of the user class loader, then the permissions is granted (a <code>SecurityException</code> is not thrown).</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccessibleObjectStub</span> </span>&#123;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> Permission STANDARD_ACCESS_PERMISSION =</div><div class="line">      <span class="keyword">new</span> ReflectPermission(<span class="string">"suppressAccessChecks"</span>);</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setAccessible</span><span class="params">(@This AccessibleObject ao, <span class="keyword">boolean</span> flag)</span></span></div><div class="line">      <span class="keyword">throws</span> SecurityException &#123;</div><div class="line">    SecurityManager sm = System.getSecurityManager();</div><div class="line">    <span class="keyword">if</span> (sm != <span class="keyword">null</span>) &#123;</div><div class="line">      Permission permission = STANDARD_ACCESS_PERMISSION;</div><div class="line">      <span class="keyword">if</span> (isFromUserLoader(ao)) &#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">          permission = getUserAccessPermission(ao);</div><div class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">          <span class="comment">// Ignore. Use standard permission.</span></div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      sm.checkPermission(permission);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Permission <span class="title">getUserAccessPermission</span><span class="params">(AccessibleObject ao)</span></span></div><div class="line">      <span class="keyword">throws</span> IllegalAccessException, InvocationTargetException, InstantiationException,</div><div class="line">      NoSuchMethodException, ClassNotFoundException &#123;</div><div class="line">    ClassLoader aoClassLoader = getAccessibleObjectLoader(ao);</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> UserSetAccessiblePermission(aoClassLoader);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> ClassLoader <span class="title">getAccessibleObjectLoader</span><span class="params">(AccessibleObject ao)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> AccessController.doPrivileged(<span class="keyword">new</span> PrivilegedAction&lt;ClassLoader&gt;() &#123;</div><div class="line">      <span class="meta">@Override</span></div><div class="line">      <span class="function"><span class="keyword">public</span> ClassLoader <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (ao <span class="keyword">instanceof</span> Executable) &#123;</div><div class="line">          <span class="keyword">return</span> ((Executable) ao).getDeclaringClass().getClassLoader();</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ao <span class="keyword">instanceof</span> Field) &#123;</div><div class="line">          <span class="keyword">return</span> ((Field) ao).getDeclaringClass().getClassLoader();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Unknown AccessibleObject type: "</span> + ao.getClass());</div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isFromUserLoader</span><span class="params">(AccessibleObject ao)</span> </span>&#123;</div><div class="line">    ClassLoader loader = getAccessibleObjectLoader(ao);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (loader == <span class="keyword">null</span>) &#123;</div><div class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> UserClassLoaders.isUserClassLoader(loader);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>This gets us most of the way, but not quite all the way there. This replacement implementation only checks the permission, but we still need to actually modify the accessibility of the object after the permission is granted. This cannot be done directly by the replacement as the accessibility is controlled by a private field on the <code>AccessibleObject</code>. We can, however, accomplish this using the method chaining feature of Byte Buddy, which can be used to chain private methods. The private field on the <code>AccessibleObject</code> class is controlled by a private method named <code>setAccessible0</code> which we can chain as part of our Byte Buddy transformation using the <code>andThen</code> method.</p>
<p>First create a Byte Buddy type pool that includes the bootstrap classloader and your jar that includes the stubs.<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">final</span> TypePool bootstrapTypePool = TypePool.Default.of(</div><div class="line">    <span class="keyword">new</span> ClassFileLocator.Compound(</div><div class="line">        <span class="keyword">new</span> ClassFileLocator.ForJarFile(jarFile),</div><div class="line">        ClassFileLocator.ForClassLoader.of(<span class="keyword">null</span>)));</div></pre></td></tr></table></figure></p>
<p>Next get the <code>AccessibleObject.setAccessible0</code> method using reflections.<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line">Method setAccessible0Method;</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">  String setAccessible0MethodName = <span class="string">"setAccessible0"</span>;</div><div class="line">  Class[] paramTypes = <span class="keyword">new</span> Class[<span class="number">2</span>];</div><div class="line">  paramTypes[<span class="number">0</span>] = AccessibleObject.class;</div><div class="line">  paramTypes[<span class="number">1</span>] = <span class="keyword">boolean</span>.class;</div><div class="line">  setAccessible0Method = AccessibleObject.class</div><div class="line">      .getDeclaredMethod(setAccessible0MethodName, paramTypes);</div><div class="line">&#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</div><div class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>With those two pieces we can now build the Byte Buddy transformer to match on the <code>setAccessible</code> method and to delegate to the stub and chain to the <code>setAccessible0</code> method.<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line">AgentBuilder.Transformer transformer = <span class="keyword">new</span> AgentBuilder.Transformer() &#123;</div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="keyword">public</span> DynamicType.Builder&lt;?&gt; transform(</div><div class="line">      DynamicType.Builder&lt;?&gt; builder,</div><div class="line">      TypeDescription typeDescription, ClassLoader classLoader) &#123;</div><div class="line">    <span class="keyword">return</span> builder.method(</div><div class="line">        ElementMatchers.named(<span class="string">"setAccessible"</span>)</div><div class="line">            .and(ElementMatchers.takesArguments(<span class="keyword">boolean</span>.class)))</div><div class="line">        .intercept(MethodDelegation.to(</div><div class="line">            bootstrapTypePool.describe(</div><div class="line">                <span class="string">"com.leacox.sandbox.security.stub.java.lang.reflect.AccessibleObjectStub"</span>)</div><div class="line">                .resolve())</div><div class="line">            .andThen(MethodCall.invoke(setAccessible0Method).withThis().withAllArguments()));</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>That will take care of replacing the default implementation of <code>setAccessible</code> with our custom implementation and chain to the <code>setAccessible0</code> method if permission is granted. If an exception occurs, for instance due to permissions not being granted, the chained transformation will exit early avoiding the call to actually change the accessibility.</p>
<p>The final step is to install Byte Buddy as a Java agent and actually perform the transformation. With a SecurityManager installed and this transformation executed, you can now run untrusted code with permissions to modify the accessibility of its own classes and methods, but not standard Java, your own runtime jar or other isolated code.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">Instrumentation instrumentation = ByteBuddyAgent.install();</div><div class="line"><span class="comment">// Append the jar containing the stub replacement to the bootstrap classpath</span></div><div class="line">instrumentation.appendToBootstrapClassLoaderSearch(jarFile);</div><div class="line"></div><div class="line">AgentBuilder agentBuilder = <span class="keyword">new</span> AgentBuilder.Default()</div><div class="line">       .disableClassFormatChanges()</div><div class="line">       .with(AgentBuilder.RedefinitionStrategy.RETRANSFORMATION)</div><div class="line">       .ignore(none()); <span class="comment">// disable default ignores so we can transform Java classes</span></div><div class="line">       .type(ElementMatchers.named(<span class="string">"java.lang.reflect.AccessibleObject"</span>))</div><div class="line">       .transform(transformer)</div><div class="line">       .installOnByteBuddyAgent();</div></pre></td></tr></table></figure>
<p>In addition to everything above, you would also want to transform the other setAccessible method, <code>setAccessible(AccessibleObject[] array, boolean flag)</code>. For more information on this and a full implementation of a simple sandboxed runtime with this transformation have a look at my <a href="https://github.com/johnlcox/sandbox-runtime" target="_blank" rel="external">sandbox-runtime</a> on Github.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://john.leacox.com/2016/07/19/selective-setaccessible-permissions-using-byte-buddy-and-the-java-securitymanager/" data-id="ciqu9o5nu000a4pjxf2e7ujke" class="article-share-link">Share</a>
      
        <a href="http://john.leacox.com/2016/07/19/selective-setaccessible-permissions-using-byte-buddy-and-the-java-securitymanager/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/security/">security</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2015/10/26/staying-motivated-on-side-projects/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Staying Motivated on Side Projects</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/07/19/selective-setaccessible-permissions-using-byte-buddy-and-the-java-securitymanager/">Selective setAccessible permissions using Byte Buddy and the Java SecurityManager</a>
          </li>
        
          <li>
            <a href="/2015/10/26/staying-motivated-on-side-projects/">Staying Motivated on Side Projects</a>
          </li>
        
          <li>
            <a href="/2015/08/13/implementing-scala-like-pattern-matching-in-java-8/">Implementing Scala-like Pattern Matching in Java 8</a>
          </li>
        
          <li>
            <a href="/2013/02/11/a-safer-way-to-create-java-subprocesses/">A Safer Way To Create Java Subprocesses</a>
          </li>
        
          <li>
            <a href="/2013/01/17/differentiate-java-processes-by-working-directory/">Differentiate Java Processes by Working Directory</a>
          </li>
        
          <li>
            <a href="/2013/01/07/drumming-as-exercise-routine/">Drumming as Exercise Routine</a>
          </li>
        
          <li>
            <a href="/2012/12/28/writing-a-good-linux-init-script/">Writing a Good Linux Init Script</a>
          </li>
        
          <li>
            <a href="/2012/12/27/my-favorite-music-of-2012/">My Favorite Music of 2012</a>
          </li>
        
          <li>
            <a href="/2012/12/14/blogging-is-hard/">Blogging is Hard</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/blogging/">blogging</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/drums/">drums</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/exercise/">exercise</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/geolode/">geolode</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lambda-expressions/">lambda expressions</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lodeup/">lodeup</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/motivation/">motivation</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/music/">music</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pattern-matching/">pattern matching</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/running/">running</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scala/">scala</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/security/">security</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/">shell</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/stackify/">stackify</a><span class="tag-list-count">2</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/blogging/" style="font-size: 10px;">blogging</a> <a href="/tags/drums/" style="font-size: 10px;">drums</a> <a href="/tags/exercise/" style="font-size: 10px;">exercise</a> <a href="/tags/geolode/" style="font-size: 10px;">geolode</a> <a href="/tags/java/" style="font-size: 20px;">java</a> <a href="/tags/lambda-expressions/" style="font-size: 10px;">lambda expressions</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/lodeup/" style="font-size: 10px;">lodeup</a> <a href="/tags/motivation/" style="font-size: 10px;">motivation</a> <a href="/tags/music/" style="font-size: 10px;">music</a> <a href="/tags/pattern-matching/" style="font-size: 10px;">pattern matching</a> <a href="/tags/running/" style="font-size: 10px;">running</a> <a href="/tags/scala/" style="font-size: 10px;">scala</a> <a href="/tags/security/" style="font-size: 10px;">security</a> <a href="/tags/shell/" style="font-size: 15px;">shell</a> <a href="/tags/stackify/" style="font-size: 15px;">stackify</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/02/">February 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/01/">January 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/12/">December 2012</a><span class="archive-list-count">3</span></li></ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 John Leacox<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'johnlcox';
  
  var disqus_url = 'http://john.leacox.com/2016/07/19/selective-setaccessible-permissions-using-byte-buddy-and-the-java-securitymanager/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

<div id="scroll2top" style="position:fixed;bottom:150px;right:50px;cursor: pointer;Z-index:9999">
<a title="返回顶部" href="#"><img src="/scroll2top/scrollup.png"/></a>
</div>
<script src="/scroll2top/scroll2top.js"></script>



  </div>
</body>
</html>